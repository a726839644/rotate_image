+function(c){var a=function(d){this.$box=c(d);this.$img=this.$box.find("img");this.boxWidth=this.$box.width();this.boxHeight=this.$box.height();this.angle=0;this.scale=this.imgURL=null;this.updateSize();this.$box.on("click",".rotate-img-controller",c.proxy(this.controlHandler,this)).on("change",".rotate-img-upload",c.proxy(this.uploadHandler,this));c(window).on("resize",c.proxy(function(){this.boxWidth=this.$box.width();this.boxHeight=this.$box.height();this.updateSize()},this))};a.VERSION="1.3.0";a.TRANSITION_DURATION=500;a.transitionEnd=(function b(){var d;var e=document.createElement("fakeelement");var f={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionsend",WebkitTransition:"webkitTransitionEnd"};for(d in f){if(e.style[d]!==undefined){return f[d]}}})();a.getBlobURL=(window.URL&&URL.createObjectURL.bind(URL))||(window.webkitURL&&webkitURL.createObjectURL.bind(webkitURL))||window.createObjectURL;a.revokeBlobURL=(window.URL&&URL.revokeObjectURL.bind(URL))||(window.webkitURL&&webkitURL.revokeObjectURL.bind(webkitURL))||window.revokeObjectURL;a.prototype.updateSize=function(g){var f=this.boxWidth/this.boxHeight;var e;if(g){e=g}else{e=new Image();e.src=this.$img.prop("src")}var d=this;c(e).on("load",function(){var k,l;var j=this.width,h=this.height;var i=j/h;if(i>f){k=d.boxWidth/j}else{k=d.boxHeight/h}if(1/i>f){l=d.boxWidth/h}else{l=d.boxHeight/j}d.scale=l/k;if(k>1){d.$img.css({width:j*k+"px"})}else{d.$img.css({width:""})}if(d.$img.prop("src")==this.src&&d.angle%180!=0){d.$img.css({transform:"scale("+d.scale+") rotate("+d.angle+"deg)"})}else{d.$img.css({transform:"scale(1,1)",transition:""});d.$img.prop({tempScale:1,tempAngle:0});d.angle=0;d.$img.prop("src",this.src)}})};a.prototype.uploadHandler=function(f){if(a.revokeBlobURL&&this.imgURL){a.revokeBlobURL(this.imgURL)}if(a.getBlobURL){this.imgURL=a.getBlobURL(c(f.target).prop("files")[0])}else{this.imgURL=f.target.value}var d=new Image();d.src=this.imgURL;this.updateSize(d)};a.prototype.controlHandler=function(){var d=this;if(!this.$img.hasClass("rotating")){var g;this.angle+=90;if(this.angle%180==0){g=1}else{g=this.scale}this.$img.addClass("rotating");if(a.transitionEnd){if(this.angle==90){this.$img.css({transition:"transform "+a.TRANSITION_DURATION+"ms"})}this.$img.css({transform:"scale("+g+") rotate("+this.angle+"deg)"});this.$img.one(a.transitionEnd,function(){c(this).removeClass("rotating")})}else{var f,e;this.$img.animate({tempScale:g,tempAngle:d.angle},{step:function(h,i){if(i.prop=="tempScale"){f=h}else{e=h;c(i.elem).css({transform:"scale("+f+","+f+") rotate("+e+"deg)"})}},complete:function(){c(this).removeClass("rotating")}})}}};c(window).on("load",function(){c(".rotate-img-box").each(function(){new a(this)})})}(jQuery);